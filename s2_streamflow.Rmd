---
title: 'Marcell Experimental Forest: S2 Stream Height (Water Years 2017 - 2019)'
author: "Mia Forsline"
date: '`r format(Sys.time(), "%B %d, %Y")`'
output:
  html_document:
    theme: flatly
    code_folding: show
    toc: yes
    toc_float: yes
  pdf_document:
    toc: yes
editor_options:
  markdown:
    wrap: 72
---

# Set Up

-   Install/load necessary R packages
-   Set working directory if necessary (or create a file path to use
    throughout the RMD to call the data from Box)

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      message = FALSE, 
                      warning = FALSE)

#install packages if necessary, then load libraries
if (!require(librarian)){
  install.packages("librarian")
  library(librarian)
}

librarian::shelf(
  here, #for file paths 
  janitor, 
  plotly, #for creating interactive plots 
  readxl, 
  tidyverse,
  zoo #for interpolating missing data points 
  )

# Set working directory path
## Mia's working directory path
#setwd("/Users/miaforsline/Library/CloudStorage/Box-Box/External-MEF_DATA/Hydro/Streamflow/L0_subdaily/StripCharts/AnnualBreakPoint/S2")
## Nina's working directory path 
#setwd("~/../../Box/External-MEF_DATA/Hydro/Streamflow/L0_subdaily/StripCharts")
```

# Manual Streamflow Checks (2017 - 2019)

-   Read in the manual streamflow checkpoints from the External-MEF_DATA
    Box folder
    -   The raw data is found at the following file path:
        `External-MEF_DATA/Hydro/Streamflow/L0_subdaily/ManualChecks`
-   Clean and manipulate the data into a tidy format
    -   Renaming columns to use lower_snake_case and avoid special
        characters via `clean_names()`
    -   Convert the `collected` column from a character into a POSIXct
        date format
    -   Remove rows with NA values in the `stripchart_stage` column
-   Subset the data to include only the data of interest (S2 weir data)
    and the time period of interest (2017 - 2019)
-   Plot the manual checks data

```{r manual_checks}
#create file path to call the data from Box 
## Mia's file path 
filepath <- "/Users/miaforsline/Library/CloudStorage/Box-Box/External-MEF_DATA/Hydro/Streamflow/L0_subdaily/ManualChecks"

#read in the manual checks data 
mc <- read_csv(here(filepath, "2017-2021_S2Stage.csv"))

#clean the data
mc_clean <- mc %>% 
  clean_names() %>% 
  #remove S2 lagging pool data and keep only the S2 weir data
  subset(name == "S2 WEIR") %>%
  mutate(collected = as.POSIXct(collected, format = '%m/%d/%Y %H:%M', 
                                tz = "GMT"),
         year = format(as.POSIXct(collected, format = '%Y-%m-%d %H:%M:%S', 
                                  tz = "GMT"), 
                       format = '%Y')
         ) %>% 
  subset(year >= 2017 & year <= 2019) %>% 
  subset(!is.na(stripchart_stage))

#plot 
ggplot(data = mc_clean) + 
  geom_point(aes(x = collected, y = stripchart_stage)) + 
  theme_classic() + 
  labs(y = "Stream Height (ft)", 
       x = "Time", 
       title = "S2 Weir Manual Streamflow Checks (2017 - 2019)") + 
  theme(plot.title = element_text(hjust = 0.5))
```

## Streamflow + Manual Checks (2017 - 2019)

-   Combine all 3 water years using `rbind()`

-   Plot stripchart data (as lines) then add the manual checks (as
    points) on top

```{r wy2017-2019}
#combine 2017 - 2019 data
all_streamflow <- rbind(wy2017_clean, wy2018_clean, wy2019_clean)

#plot
p_all <- ggplot(data = all_streamflow) + 
  geom_line(aes(x = datetime, y = stream_height_ft),
            size = 0.25) + 
  geom_point(data = mc_clean, 
             aes(x = collected, 
                 y = stripchart_stage), 
             color = "red",
             size = 0.5) + 
  theme_classic() + 
  labs(x = "Time", 
       y = "Stream Height (ft)",
       title = "WY 2017 - 2019 S2 Bog Stream Height",
       subtitle = "Stripchart data are plotted as black lines. Manual checks are plotted as red dots.") + 
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))

#static plot
#p_all

#save PNG file
ggsave(filename = "streamflow_with_manual_checks.png",
       plot = p_all,
       path = "figures/",
       width = 6,
       height = 3,
       units = c("in"),
       dpi = 300)

#interactive plot 
ggplotly(p_all)
```

## 1:1 Stripchart vs Manual Checkpoints (2017 - 2019)

Next, we are interested in a 1:1 comparison of stripchart data vs manual
checkpoints data at the exact same timestamp. Since the stripchart data
and manual checkpoints do not align perfectly, we will interpolate the
stripchart stream flow values using the `zoo` package to estimate
stripchart values at the time of the manual checks.

```{r 1_to_1}
#clean the data 
mc_sub <- mc_clean %>% 
  #extract the data (without the timestamp)
  mutate(date = format(as.POSIXct(collected, format = '%m/%d/%Y %H:%M:%S', 
                                  tz = "GMT"), 
                       format = '%Y-%m-%d'),
         date = as.POSIXct(date, tz = "GMT")) %>% 
  #rename column
  rename(datetime = collected) %>% 
  #remove unnecessary columns 
  select(-site, -lab_id, -name, -point_gage, -logger_stage) 

#identify date ranges of interest: 2017-04-04 to 2019-12-31
##aka the range of the manual checkpoint data
max_date <- max(mc_sub$date)
min_date <- min(mc_sub$date)

#subset stripchart data to fit within the time range of the manual checkpoints
streamflow_sub <- all_streamflow %>% 
  subset(date <= max_date & date >= min_date) 

#join the stripchart data and manual checks data 
streamflow_mc_fj <- full_join(x = mc_sub, 
                  y = streamflow_sub, 
                  by = c("datetime", "date")) %>% 
  #rearrange dataframe into a long format 
  pivot_longer(cols = c("stripchart_stage", "stream_height_ft"),
               names_to = "types",
               values_to = "stream_height_ft") %>% 
  #interpolate stripchart values to fill in NA values for timestamps of interest
  mutate(approx = na.approx(stream_height_ft, 
                            method = "linear"))

#left join the joined data and manual checks data to keep only the timestamps of interest 
streamflow_mc_lj <- left_join(x = mc_sub, 
                     y = streamflow_mc_fj,
                     by = c("datetime", "year", "date")) %>% 
  #calculate the difference between the stripchart - interpolated value
  mutate(diff = lag(x = stream_height_ft, n = 1) - approx)

#plot interpolated values 
p_1to1 <- ggplot() + 
  geom_point(data = streamflow_mc_lj,
             aes(x = datetime, y = approx, color = types),
             alpha = 0.5) + 
  theme_classic() + 
  labs(x = "Time",
       y = "Stream Height (ft)",
       title = "S2 Manual Checks vs Interpolated Stripchart Values",
       color = "Data Collection Type") +
  scale_color_discrete(labels = c("Stripchart", "Manual Check")) + 
    theme(plot.title = element_text(hjust = 0.5))

#static plot
p_1to1

#save the figure 
ggsave(filename = "streamflow_mc_comparison.png",
       plot = p_1to1,
       path = "figures/",
       width = 6,
       height = 3,
       units = c("in"),
       dpi = 300)
  
#drop NA values from the difference column to plot better
streamflow_mc_diff <- streamflow_mc_lj %>% 
  drop_na(diff)

#plot the difference in values (stripchart - manual checks)
p_diff <- ggplot(data = streamflow_mc_diff) + 
  geom_point(aes(x = datetime, y = diff), 
             size = 0.5) + 
  geom_line(aes(x = datetime, y = diff)) + 
  theme_classic() + 
  labs(x = "Time",
       y = "Difference in Stream Height (ft)",
       title = "Difference Between Stripcharts and Manual Checks",
       subtitle = "Differences were calculated as stripchart value - manual checks value.") + 
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))

#static plot
p_diff 

#save the figure 
ggsave(filename = "streamflow_mc_diff.png",
       plot = p_diff,
       path = "figures/",
       width = 6,
       height = 3,
       units = c("in"),
       dpi = 300)
```

# Old Shaft Encoder Data (2017 - 2019)

-   Read in the manual checks data from the External-MEF_DATA Box folder

    -   Specifically, raw data is found at the following file path:
        `External-MEF_DATA/Hydro/Streamflow/L1_subdaily`

-   Clean and manipulate the data into a tidy format

    -   Renaming columns to use lower_snake_case and avoid special
        characters via `clean_names()`
    -   Remove extraneous columns
    -   Rename columns to join the data later

-   Plot the old shaft encoder data

```{r}
#create file path to call the data from Box 
## Mia's file path 
filepath <- "/Users/miaforsline/Library/CloudStorage/Box-Box/External-MEF_DATA/Hydro/Streamflow/L1_subdaily/"

#read in the 2019 data 
se_data <- read_csv(here(filepath, "S2_5min_2017-2019.csv"))

#clean the data 
se_clean <- se_data %>% 
  clean_names() %>% 
  select(-x1, -record, -cond, -ct, -streamflow_cfs, -streamflow_lps, -temp_c) %>% 
  rename(datetime = timestamp)

#plot 
ggplot() + 
  geom_line(data = se_clean, aes(x = datetime, y = stage)) + 
  theme_classic() + 
  labs(x = "Time", 
       y = "Stream Height (ft)",
       title = "Shaft Encoder S2 Bog (2017 - 2019)") + 
  theme(plot.title = element_text(hjust = 0.5))
  
```

# Climate and Bogwell data

## Precipitation Every 15min

-   Read in the data from the following Box file path:
    `External-MEF_DATA/EDI/precipitation_15min/edi.849.2/data_objects/`

-   Clean the data into a tidy format

    -   Subset precipitation data to 2017 - present

-   Plot

```{r precip_15}
#set file path to read in data from Box 
filepath = "/Users/miaforsline/Library/CloudStorage/Box-Box/External-MEF_DATA/EDI/precipitation_15min/edi.849.2/data_objects/"

#read in the raw data 
precip_15 <- read_csv(here(filepath, "MEF_South_precip_15min.csv"))

#clean the data 
precip_15_clean <- precip_15 %>% 
  clean_names() %>% 
  mutate(year = format(as.POSIXct(timestamp, format = '%Y-%m-%d %H:%M:%S', 
                                  tz = "GMT"), 
                       format = '%Y'),
         year = as.numeric(year)) %>% 
  subset(year >= 2017) %>% 
  rename(precip_in = south_pcp) %>% 
  mutate(precip_10 = (precip_in / 10)) %>% 
  pivot_longer(
    cols = c("precip_in", "precip_10"),
    names_to = "precip_type",
    values_to = "precip_in"
  )

#plot 
p_15 <- ggplot(data = precip_15_clean) + 
  geom_line(aes(x = timestamp, y = precip_in, color = precip_type)) + 
  theme_classic() + 
  labs(x = "Time", 
       y = "Precipitation (cm)", 
       title = "2017 - 2019 Precipitation Sum Every 15 Min")

#ggplotly(p_15)
```

## Precipitation Daily

-   Read in the data from the following Box file path:
    `External-MEF_DATA/EDI/precipitation_daily/edi.563.3/data_objects/`

-   Clean the data into a tidy format

    -   Subset precipitation data to 2017 - present

-   Plot

```{r precip_daily}
#set file path to read in data from Box 
filepath = "/Users/miaforsline/Library/CloudStorage/Box-Box/External-MEF_DATA/EDI/precipitation_daily/edi.563.3/data_objects/"

#read in the raw data 
precip_daily <- read_csv(here(filepath, "MEF_precipitation_daily.csv"))

#clean the data 
precip_daily_clean <- precip_daily %>% 
  clean_names() %>% 
  select(date, south_pcp, south_flag) %>% 
  mutate(year = format(as.POSIXct(date, format = '%Y-%m-%d', 
                                  tz = "GMT"), 
                       format = '%Y'),
         year = as.numeric(year)) %>% 
  subset(year >= 2017) %>% 
  rename(precip_in = south_pcp) %>% 
  mutate(precip_10 = (precip_in / 10)) %>% 
  pivot_longer(
    cols = c("precip_in", "precip_10"),
    names_to = "precip_type",
    values_to = "precip_in"
  )

#plot 
p_daily <- ggplot(data = precip_daily_clean) + 
  geom_line(aes(x = date, y = precip_in, color = precip_type)) + 
  theme_classic() + 
  labs(x = "Time", 
       y = "South Precipitation (in)", 
       title = "2017 - 2019 Precipitation Daily Sum")

#static plot
#p_daily

#ggplotly(p_daily)
```

## Air Temperature Every 30 Min

-   Read in the data from the following Box file path:
    `External-MEF_DATA/EDI/airT_RH_BP_30min/edi.990.1/data_objects/`

-   Clean the data into a tidy format

    -   Subset precipitation data to 2017 - present

-   Plot

```{r airtemp_30}
#set file path to read in data from Box 
filepath = "/Users/miaforsline/Library/CloudStorage/Box-Box/External-MEF_DATA/EDI/airT_RH_BP_30min/edi.990.1/data_objects/"

#read in the raw data 
air_temp_30 <- read_csv(here(filepath, "MEF_S2Bog_Met_30min.csv"))

#clean the data 
air_temp_30_clean <- air_temp_30 %>% 
  clean_names() %>% 
  rename(airtempc = air_t,
         rel_humidity = rh,
         datetime = timestamp) %>% 
  mutate(year = format(as.POSIXct(datetime, format = '%Y-%m-%d %H:%M:%S', 
                                  tz = "GMT"), 
                       format = '%Y'),
         year = as.numeric(year),
         airtempc_10 = (airtempc / 10),
         airtempc_100 = (airtempc / 100)
         ) %>% 
  pivot_longer(
    cols = c("airtempc", "airtempc_10", "airtempc_100"),
    names_to = "airtemp_type",
    values_to = "airtempC"
  )

#plot 
p_air_30 <- ggplot(data = air_temp_30_clean) + 
  geom_line(aes(x = datetime, y = airtempC, color = airtemp_type)) + 
  theme_classic() + 
  labs(x = "Time", 
       y = "Air Temperature (ºC)", 
       title = "2017 - 2022 Daily Air Temperatures")

#static plot
p_air_30

#interactive plot
#ggplotly(p_air_30)
```

## Peatland Daily Water Table

-   Read in the data from the following Box file path:
    `External-MEF_DATA/EDI/peatland_water_table_daily/edi.562.2/data_objects/`

-   Clean the data into a tidy format

    -   Subset precipitation data to 2017 - present

-   Plot

```{r bogwell_daily}
#set file path to read in data from Box 
filepath = "/Users/miaforsline/Library/CloudStorage/Box-Box/External-MEF_DATA/EDI/peatland_water_table_daily/edi.562.2/data_objects/"

#read in the raw data 
bogwell <- read_csv(here(filepath, "MEF_daily_peatland_water_table.csv"))

#clean the data
bogwell_clean <- bogwell %>% 
  clean_names() %>% 
  subset(peatland == "S2") %>% 
  mutate(year = format(as.POSIXct(date, format = '%Y-%m-%d', 
                                  tz = "GMT"), 
                       format = '%Y'),
         year = as.numeric(year)) %>% 
  subset(year >= 2017 & year <= 2019)

#plot
p_bogwell <- ggplot(data = bogwell_clean) + 
  geom_line(aes(x = date, y = wte)) + 
  theme_classic() + 
  labs(x = "Time", 
       y = "Water Table Elevation (m above sea level)",
       title = "S2 Daily Peatland Water Table Elevation")

#static plot 
p_bogwell

#interactive plot
#ggplotly(p_bogwell)
```

# Comparisons

## Streamflow + precipitation (every 15min)

```{r}
#format precipitation data for a smooth joining process
precip_15_join <- precip_15_clean %>% 
  rename(datetime = timestamp) %>% 
  pivot_wider(
    names_from = "precip_type",
    values_from = "precip_in"
  ) %>% 
  subset(year <= 2019 & year >= 2017)

#join streamflow and precipitation data 
streamflow_precip_15 <- full_join(x = all_streamflow, y = precip_15_join, by = "datetime") %>% 
  rename(precip_10_in = precip_10) %>% 
  select(-precip_in) 

#plot 
p_sp <- ggplot() + 
  #precipitation data 
  geom_line(data = streamflow_precip_15, 
            aes(x = datetime, 
                y = precip_10_in,
                colour = I("grey")),
            size = 0.25) + 
  #streamflow data 
  geom_line(data = all_streamflow,
             aes(x = datetime, 
                 y = stream_height_ft),
            color = "blue",
            size = 0.25) + 
  theme_classic() + 
  labs(x = "Time", 
       title = "2017 - 2019 S2 Bog Streamflow and Scaled Precipitation",
       subtitle = "Streamflow is plotted in blue. Precipitation is plotted in black.") + 
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5, 
                                     size = 7)) + 
  scale_y_continuous(
    # Features of the first axis
    name = "Stream Height (ft)",
    # Add a second axis and specify its features
    sec.axis = sec_axis(trans = ~.*0.698509267, name = "Precipitation Sum Scaled by 10 (in)")
  ) 

#static plot
#p_sp

#save the plot in the figures folder 
ggsave(filename = "streamflow_precip.png",
       plot = p_sp,
       path = "figures/",
       width = 6,
       height = 3,
       units = c("in"),
       dpi = 300)

#interactive plot
#ggplotly(p_sp)
```

## Streamflow + precipitation (daily cumulative) + manual checks

```{r}
#format precipitation data for a smooth joining process
precip_daily_join <- precip_daily_clean %>% 
  pivot_wider(
    names_from = "precip_type",
    values_from = "precip_in"
  ) %>% 
  subset(year <= 2019 & year >= 2017)

#join streamflow and daily precipitation data 
streamflow_precip_daily <- full_join(x = all_streamflow, y = precip_join, by = "datetime") %>% 
  rename(precip_10_in = precip_10) %>% 
  select(-precip_in) %>% 
  subset(year <= 2019 & year >= 2017)

#plot 
p_spmc <- ggplot() + 
  #precipitation data 
  geom_line(data = streamflow_precip_daily, 
            aes(x = datetime, 
                y = precip_10_in,
                colour = I("grey")),
            size = 0.25) + 
  #streamflow data 
  geom_line(data = all_streamflow,
             aes(x = datetime, 
                 y = stream_height_ft),
            color = "blue",
            size = 0.25) + 
  #manual check points
  geom_point(data = mc_clean, 
             aes(x = collected, y = stripchart_stage),
             size = 0.5) + 
  theme_classic() + 
  labs(x = "Time", 
       title = "2017 - 2019 S2 Bog Streamflow and Daily Cumulative Precipitation",
       subtitle = "Streamflow is plotted in blue. \n Precipitation is plotted in grey. \n Manual streamflow checks are plotted as black points.") + 
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5, 
                                     size = 7)) + 
  scale_y_continuous(
    #features of the first axis
    name = "Stream Height (ft)",
    #add a second axis and specify its features
    ##determine the ratio between the max value of Axis 1 vs the max value of Axis 2 to decide what number to put in the trans argument
    ###for example, max value of precipitation / max value of streamflow = 0.533... 
    sec.axis = sec_axis(trans = ~.*0.53326422081, name = "Cumulative Daily Precipitation / 10 (in)")
  ) 


#static plot
p_spmc

#save the plot in the figures folder 
ggsave(filename = "streamflow_precip_manual_checks.png",
       plot = p_spmc,
       path = "figures/",
       width = 6,
       height = 3,
       units = c("in"),
       dpi = 300)

#interactive plot 
#ggplotly(p_sp)
```

## Streamflow + air temperature data (every 30min)

```{r}
#format air temperature data 
airtemp_join <- air_temp_30_clean %>% 
  pivot_wider(
    names_from = "airtemp_type",
    values_from = "airtempC"
  ) %>% 
  subset(year >= 2017 & year <= 2019)

#plot 
p_samc <- ggplot() + 
  # #precipitation data 
  # geom_line(data = streamflow_precip, 
  #           aes(x = datetime, 
  #               y = precip_10_in,
  #               colour = I("grey")),
  #           size = 0.25) + 
  #airtemp data
  geom_line(data = airtemp_join, 
            aes(x = datetime, 
                y = airtempc_100),
            color = "pink",
            alpha = 0.5,
            size = 0.25) + 
  #streamflow data 
  geom_line(data = all_streamflow,
             aes(x = datetime, 
                 y = stream_height_ft),
            color = "blue",
            size = 0.25) + 
  #manual check points
  geom_point(data = mc_clean, 
             aes(x = collected, y = stripchart_stage),
             size = 0.5) + 
  theme_classic() + 
  labs(x = "Time", 
       title = "S2 Bog Streamflow and Air Temperature (2017 - 2019)",
       subtitle = "Air temperature is plotted in pink. \n Streamflow is plotted in blue. \n Manual streamflow checkpoints are plotted as black dots.") + 
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5, 
                                     size = 7)) + 
  scale_y_continuous(
    # Features of the first axis
    name = "Air Temperature / 100 (ºC)",
    # Add a second axis and specify its features
    sec.axis = sec_axis(trans = ~.*1, name = "Stream Height (ft)")
  ) 

#static plot
#p_samc

#save the plot in the figures folder 
ggsave(filename = "streamflow_airtemp_manual_checks.png",
       plot = p_samc,
       path = "figures/",
       width = 6,
       height = 4,
       units = c("in"),
       dpi = 300)

#interactive plot
ggplotly(p_samc)
```

## Streamflow + bogwell data

```{r}
#calculate median + min bogwell water table elevation (wte) values 
median_bog <- median(bogwell_clean$wte)
min_bog <- min(bogwell_clean$wte)

#calculate the difference of wte values from the median and min 
bogwell_diff <- bogwell_clean %>% 
  mutate(diff_from_med = bogwell_clean$wte - median_bog,
         diff_from_min = bogwell_clean$wte - min_bog)

#sum streamflow by day 
streamflow_daily <- all_streamflow %>% 
  group_by(date) %>% 
  summarise(sum_stream_height_ft = sum(stream_height_ft, na.rm = TRUE))

#combine daily precipitation + daily streamflow sums 
streamflow_precip_daily <- full_join(x = precip_daily_clean,
                                     y = streamflow_daily,
                                     by = "date") %>% 
  pivot_wider(names_from = "precip_type",
              values_from = "precip_in") %>% 
  select(-south_flag,
         -"NA") %>% 
  subset(year <= 2019)

#combine daily precipitation/streamflow with bogwell data 
streamflow_precip_bogwell <- full_join(x = streamflow_precip_daily, y = bogwell_diff, by = c("date", "year")) %>% 
  select(-flag,
         -peatland) %>% 
  mutate(wte_100 = (wte / 100)) %>% 
  subset(year <= 2019)


#plot 
p_sb <- ggplot() + 
 # #precipitation data 
 #  geom_line(data = streamflow_precip_bogwell, 
 #            aes(x = date, 
 #                y = precip_10,
 #                colour = I("grey")),
 #            size = 0.25) + 
  #streamflow data 
  geom_line(data = streamflow_precip_bogwell,
             aes(x = date, 
                 y = sum_stream_height_ft),
            color = "blue",
            size = 0.25) + 
  #bogwell data
  geom_line(data = streamflow_precip_bogwell,
            aes(x = date,
                y = diff_from_min), 
            color = "green",
            size = 0.25) +
  theme_classic() + 
  labs(x = "Time", 
       title = "S2 Bog Streamflow and Daily Peatland Water Table Elevation",
       subtitle = "Streamflow is plotted in blue. Bogwell data is plotted in green") + 
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5, 
                                     size = 7)) + 
  scale_y_continuous(
    # Features of the first axis
    name = "Peatland WTE / 100 (m above sea level)",
    # Add a second axis and specify its features
    sec.axis = sec_axis(trans = ~.*1, name = "Stream Height (ft)")
  ) 

#static plot
p_sb

#save the plot in the figures folder 
ggsave(filename = "streamflow_bogwell.png",
       plot = p_sb,
       path = "figures/",
       width = 6,
       height = 3,
       units = c("in"),
       dpi = 300)

#interactive plot 
#ggplotly(p_sb)
```

## Stripchart + old shaft encoder data

```{r}
stripchart_se <- full_join(x = all_streamflow, y = se_clean, by = "datetime")

p_stripchart_se <- ggplot() + 
  geom_line(data = all_streamflow, 
            aes(x = datetime, y = stream_height_ft),
            color = "blue",
            size = 0.25) + 
  geom_line(data = se_clean, 
            aes(x = datetime, y = stage),
            color = "red",
            alpha = 0.75,
            size = 0.25) + 
  theme_classic() + 
  labs(x = "Time", 
       y = "Stream Height (ft)",
       title = "Stripchart vs Shaft Encoder S2 Streamflow (2017 - 2019)",
       subtitle = "Stripchart data is in blue. Shaft encoder data is in red.") + 
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5, 
                                     size = 7))

#static plot
#p_stripchart_se

ggsave(filename = "stripchart_shaft_encoder.png",
       plot = p_stripchart_se,
       path = "figures/",
       width = 6,
       height = 3,
       units = c("in"),
       dpi = 300)

ggplotly(p_stripchart_se)
```
