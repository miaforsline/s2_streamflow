---
title: "s2_streamflow"
author: "Mia Forsline"
date: '2022-06-21'
output: html_document
---
# Set Up 
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      message = FALSE, 
                      warning = FALSE)

#install packages if necessary, then load libraries
if (!require(librarian)){
  install.packages("librarian")
  library(librarian)
}

librarian::shelf(
  here,
  janitor,
  naniar,
  #lubridate,
  readxl,
  tidyverse,
  #writexl,
  #zoo
  )
```

# Read in and clean up 2017 streamflow data 
```{r, include=FALSE}
# Set working directory path
setwd("/Users/miaforsline/Library/CloudStorage/Box-Box/External-MEF_DATA/Hydro/Streamflow/L0_subdaily/StripCharts/AnnualBreakPoint/S2")
#setwd("~/../../Box/External-MEF_DATA/Hydro/Streamflow/L0_subdaily/StripCharts")

#create filepath 
filepath <- "/Users/miaforsline/Library/CloudStorage/Box-Box/External-MEF_DATA/Hydro/Streamflow/L0_subdaily/StripCharts/AnnualBreakPoint/S2"


#read in the 2017 data 
wy2017 <- read_excel(path = here(filepath, "WY2017.S2_Breakpoint.xlsx"), 
                     skip =3)

#clean the 2017 data
wy2017_clean <- wy2017 %>% 
  rename(datetime = "Date/time",
         stream_height_ft = "Stage.ft") %>% 
  select(c("datetime", "stream_height_ft")) %>% 
  clean_names()

#test the 2017 data
if(nrow(wy2017) != nrow(wy2017_clean)) stop("Check clean dataframe dimensions")

#read in the 2018 data 
wy2018 <- read_excel(path = here(filepath, "WY2018.S2_Breakpoint.xlsx"), 
                     skip =3)
```

# 2018 water year data 
December 1-3 clock stopped, no record
December 8-10 pin reached end of chart, no record
Dec 11-end, clock is barely running. No way to tell which days are what on the chart.

November 10-14 clock stopped, no record.
November 25- December 4 clock stopped, no record
Possibly the clock was moving super slowly for some of it?

For Oct 9-10 there was no rain for flow to increase.
Oct 11-15 clock was stuck and the pin did not move forward in time.
```{r, include=FALSE}
#clean the 2018 data
wy2018_clean <- wy2018 %>% 
  rename(datetime = "Date/time",
         stream_height_ft = "Stage.ft") %>% 
  select(c("datetime", "stream_height_ft")) %>% 
  clean_names() %>% 
  mutate(date = format(as.POSIXct(datetime,format='%m/%d/%Y %H:%M:%S'),format='%Y-%m-%d'),
         date = as.POSIXct(date)) 

wy2018_clean$stream_height_ft[wy2018_clean$date %between% as.Date(c('2018-12-01', '2018-12-03'))] <- NA

# 
# 
# 
# 
# subset <- wy2018_clean %>% 
#   subset(datetime >= as.POSIXct("2018-12-01 00:00:00", tz = "UTC") & 
#                    datetime <= as.POSIXct("2018-12-03 12:00:00", tz = "UTC")) %>% 
#   mutate(stream_height_ft = NA)
#   
# subset2 <- wy2018_clean
# 
# 
# 
# 
# if (subset2$datetime >= as.POSIXct("2018-12-01 00:00:00", tz = "UTC") & 
#                    subset2$datetime <= as.POSIXct("2018-12-03 12:00:00", tz = "UTC")) {
#   subset2$stream_height_ft[subset2$stream_height_ft <- 99]
# } else{
#   
# }
# 
# #create a function to set NA values during custom time periods 
# `%between%` <- function(x, interval) x >= interval[1] & x <= interval[2]
# 
# wy2018_na <- wy2018_clean %>% 
#   within(stream_height_ft <- NA * (date %between% as.Date(c('2018-12-01', '2018-12-03'))))


#test the 2018 data
if(nrow(wy2018) != nrow(wy2018_clean)) stop("Check clean dataframe dimensions")
```


```{r, include=FALSE}
#read in the 2019 data 
wy2019 <- read_excel(path = here(filepath, "WY2019.S2_Breakpoint.xlsx"), 
                     skip =3)

#clean the 2019 data
wy2019_clean <- wy2019 %>% 
  rename(datetime = "Date/time",
         stream_height_ft = "Stage.ft") %>% 
  select(c("datetime", "stream_height_ft")) %>% 
  clean_names()

#test the 2019 data 
if(nrow(wy2019) != nrow(wy2019_clean)) stop("Check clean dataframe dimensions")

```



## Plot 
```{r}
ggplot(data = wy2017_clean) + 
  geom_line(aes(x = datetime, y = stream_height_ft)) + 
  theme_classic() + 
  labs(x = "Time", 
       y = "Stream Height (Ft)")

ggplot(data = wy2018_clean) + 
  geom_line(aes(x = datetime, y = stream_height_ft)) + 
  theme_classic() + 
  labs(x = "Time", 
       y = "Stream Height (Ft)")

ggplot(data = wy2019_clean) + 
  geom_line(aes(x = datetime, y = stream_height_ft)) + 
  theme_classic() + 
  labs(x = "Time", 
       y = "Stream Height (Ft)")
```

